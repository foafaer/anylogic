# Проект-домашнее задание для AnyLogic

Проект многомодульный, состоит из двух проектов:

- anylogic-manager - менеджер задач и имеет REST API из двух эндпоинтов:
  1) эндпоинт для вычисления factorial-а числа указанного в запросе
  2) эндпоинт отмены такой операции по идентификатору запроса
- anylogic-worker - воркер и умеет асинхронно вычислять факториал числа с поддержкой отмены вычисления.

Так же проект содержит `docker-compose.yml` для запуска контейнера RabbitMQ.

# Технологический стек
- Java 17
- Gradle 8.5
- Docker, Docker Compose

# Запуск
- Подкачать проект
- Собрать проект командой `./gradlew clean build`
- Запустить контейнер RabbitMQ командой `docker compose up`
- Запустить springboot проекты командами `./gradlew :anylogic-worker:bootRun` и `./gradlew :anylogic-worker:bootRun`

# Тестирование

После запуска проекта можно проверить работоспособность приложения, отправив запрос `POST http://localhost:8080/manager/task?number=1`.
В ответ должно распечататься в консоли приложения (пример): `Result received: Response{taskId='e52e1d8f-a490-4802-acfd-709a7a84dc57', result='1', status='Completed'}`.


1. Тестирование успешного вычисления факториала
   Шаги:
   Отправьте задачу на вычисление факториала, например, числа 5, отправив запрос `POST http://localhost:8080/manager/task?number=5`
   Подождите, пока вычисление завершится.
   Убедитесь, что результат (120) был отправлен в ответное сообщение.
   Ожидаемый результат:
   Задача выполнена успешно.
   В логе видно сообщение о начале и завершении задачи:
   Копировать код
   Received calculating task.
   Calculation finished successfully.
   В ответе от RabbitMQ должно прийти сообщение с результатом:
   {"taskId": "id", "result": "120", "status": "Completed"}.
2. Тестирование асинхронного выполнения нескольких задач параллельно
   Шаги:
   Отправьте несколько задач на вычисление факториалов для разных чисел (например, 5, 6, 7) одновременно.
   Подождите, пока все задачи завершатся.
   Ожидаемый результат:
   Все задачи выполняются параллельно (что можно проверить по логам и времени выполнения).
   В логе отображается, что задачи запущены одновременно:
   Received calculating task.
   Received calculating task.
   Received calculating task.
   Каждая задача завершена с правильным результатом:
   Для 5: 120
   Для 6: 720
   Для 7: 5040
3. Тестирование отмены задачи во время выполнения
   Шаги:
   Отправьте задачу на вычисление факториала большого числа (например, 20), чтобы задача выполнялась некоторое время.
   Пока задача выполняется, отправьте запрос на отмену задачи с указанием taskId.
   Проверьте, что задача была остановлена.
   Ожидаемый результат:
   В логе видно, что задача была отменена:
   Копировать код
   Calculation task cancelled.
   В RabbitMQ отправлено сообщение об отмене задачи: {"taskId": "id", "result": null, "status": "Cancelled"}.
4. Тестирование отмены уже завершённой задачи
   Шаги:
   Отправьте задачу на вычисление факториала небольшого числа (например, 5), чтобы она быстро завершилась.
   После её завершения, попробуйте отменить задачу, отправив запрос на отмену с тем же taskId.
   Ожидаемый результат:
   В логе отображается, что задача уже завершена:
   Копировать код
   Calculation finished successfully.
   Запрос на отмену не влияет на уже завершённую задачу.
   В ответ от RabbitMQ должно прийти сообщение с результатом:
   {"taskId": "id", "result": "120", "status": "Completed"}.
   Лог или уведомление об отмене не должны появляться.
5. Тестирование обработки ошибок
   Шаги:
   Отправьте некорректные данные (например, отрицательное число) в задачу на вычисление факториала.
   Убедитесь, что система корректно обрабатывает ошибку.
   Ожидаемый результат:
   В ответ от RabbitMQ должно прийти сообщение с результатом:
   {taskId='null', result='null', status='Number must be positive!'}.
6. Тестирование восстановления после прерывания задачи
   Шаги:
   Отправьте задачу на вычисление факториала и вручную прервите выполнение (например, через остановку потока).
   Перезапустите задачу.
   Ожидаемый результат:
   В логах отразится ошибка, связанная с прерыванием потока:
   Копировать код
   Calculation interrupted.
   Задача не завершилась корректно, и RabbitMQ получает сообщение о сбое: {"taskId": "id", "result": null, "status": "Error: Interrupted"}.
7. Тестирование с большими числами
   Шаги:
   Отправьте задачу на вычисление факториала большого числа (например, 100 или 200).
   Убедитесь, что задача выполняется достаточно долго и результат передан без ошибок.
   Ожидаемый результат:
   Лог отображает успешное завершение задачи:
   Копировать код
   Calculation finished successfully.
   Сообщение в RabbitMQ с правильным результатом большого числа: {"taskId": "id", "result": "<very_large_number>", "status": "Completed"}.
8. Тестирование параллельных отмен и завершения задач
   Шаги:
   Отправьте несколько задач на вычисление факториала для разных чисел.
   Отмените одну из них во время выполнения.
   Убедитесь, что остальные задачи завершились успешно.
   Ожидаемый результат:
   Лог показывает, что одна из задач отменена:
   Копировать код
   Calculation task cancelled.
   Остальные задачи завершаются успешно, а отменённая задача возвращает статус отмены.
   Сообщения от RabbitMQ:
   Задачи с завершённым вычислением: {"taskId": "id", "result": "120", "status": "Completed"}.
   Отменённая задача: {"taskId": "id", "result": null, "status": "Cancelled"}.
